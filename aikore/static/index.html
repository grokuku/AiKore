<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AiKore Dashboard</title>
    <link rel="stylesheet" href="/static/style.css">
    <!-- NEW: Xterm.js styles -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/xterm@5.3.0/css/xterm.min.css" />
</head>

<body>
    <div class="main-container">
        <h1 class="main-title">AiKore</h1>

        <!-- This is the PARENT for the VERTICAL split -->
        <div id="main-split" class="split-container split-vertical">

            <!-- PANNEAU SUPÃ‰RIEUR : INSTANCE MANAGER -->
            <div id="instance-pane" class="pane">
                <div class="pane-header">
                    <h2>Instances Manager</h2>
                    <button class="add-new-btn">Add New Instance</button>
                </div>
                <div class="pane-content table-container">
                    <table class="instances-table">
                        <thead>
                            <tr>
                                <th class="drag-handle-column"></th>
                                <th>Name</th>
                                <th>Base Blueprint</th>
                                <th>GPU IDs</th>
                                <th>Autostart</th>
                                <th>Persistent UI</th>
                                <th class="status-column">Status</th>
                                <th>Custom Address</th>
                                <th>Port</th>
                                <th class="actions-column">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="instances-tbody">
                            <!-- Instance rows will be dynamically inserted here by JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- This is the PARENT for the HORIZONTAL split -->
            <div id="bottom-split" class="split-container split-horizontal">
                <!-- Colonne de gauche : Outils -->
                <div id="tools-pane" class="pane">
                    <div class="pane-header">
                        <h2 id="tools-pane-title">Tools / Welcome</h2>
                        <button id="tools-close-btn" class="close-btn hidden">&times;</button>
                    </div>
                    <div class="pane-content">
                        <!-- Container for the Welcome Screen (visible by default) -->
                        <div id="welcome-screen-container">
                            <iframe id="welcome-iframe" src="about:blank" frameborder="0"></iframe>
                        </div>

                        <!-- Container for the Log Viewer (hidden by default) -->
                        <div id="log-viewer-container" class="terminal-style hidden">
                            <pre><code id="log-content-area"></code></pre>
                        </div>

                        <!-- Container for the File Editor (hidden by default) -->
                        <div id="editor-container" class="hidden">
                            <textarea id="file-editor-textarea" spellcheck="false"></textarea>
                            <div class="editor-actions">
                                <button id="editor-save-btn" class="action-btn">Save</button>
                                <button id="editor-exit-btn" class="action-btn">Exit Editor</button>
                            </div>
                        </div>

                        <!-- Container for the embedded Instance View (hidden by default) -->
                        <div id="instance-view-container" class="hidden">
                            <iframe id="instance-iframe" src="about:blank" frameborder="0"></iframe>
                        </div>

                        <!-- NEW: Container for the Terminal (hidden by default) -->
                        <div id="terminal-view-container" class="hidden">
                            <div id="terminal-content"></div>
                        </div>

                        <!-- NEW: Container for the Version Check tool (hidden by default) -->
                        <div id="version-check-container" class="hidden">
                            <div class="terminal-style">
                                <h3>Version Information</h3>
                                <pre><code id="version-check-versions-area"></code></pre>
                            </div>
                            <div class="terminal-style" style="margin-top: 20px;">
                                <h3>Dependency Conflicts</h3>
                                <pre><code id="version-check-conflicts-area"></code></pre>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Colonne de droite : Monitoring -->
                <div id="monitoring-pane" class="pane">
                    <div class="pane-header">
                        <h2>System Monitoring</h2>
                    </div>
                    <div class="pane-content" id="system-stats-container">
                        <!-- System Stats will be dynamically inserted here -->
                        <div class="system-stat-block">
                            <span class="system-block-name">System</span>
                            <div class="system-block-metrics">
                                <div class="system-stat-row">
                                    <span class="stat-label">CPU</span>
                                    <div class="progress-bar-container">
                                        <div id="cpu-progress" class="progress-bar"></div>
                                    </div>
                                    <span id="cpu-percent-text" class="stat-value">...</span>
                                </div>
                                <div class="system-stat-row">
                                    <span class="stat-label">RAM</span>
                                    <div class="progress-bar-container">
                                        <div id="ram-progress" class="progress-bar"></div>
                                    </div>
                                    <span id="ram-usage-text" class="stat-value">...</span>
                                </div>
                            </div>
                        </div>

                        <div id="gpu-stats-container">
                            <!-- GPU stats will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Template for a single GPU display -->
    <template id="gpu-stat-template">
        <div class="gpu-stat">
            <span class="gpu-name">GPU 0: NVIDIA GeForce RTX 3090</span>
            <div class="gpu-metrics">
                <div class="gpu-metric">
                    <span class="stat-label">VRAM</span>
                    <div class="progress-bar-container">
                        <div class="progress-bar vram-progress"></div>
                    </div>
                    <span class="stat-value vram-usage-text">...</span>
                </div>
                <div class="gpu-metric">
                    <span class="stat-label">Util.</span>
                    <div class="progress-bar-container">
                        <div class="progress-bar util-progress"></div>
                    </div>
                    <span class="stat-value util-percent-text">...</span>
                </div>
            </div>
        </div>
    </template>

    <!-- Universal Context Menu for Tools -->
    <div id="tools-context-menu" class="context-menu">
        <button class="context-item" data-action="terminal">Terminal</button>
        <button class="context-item" data-action="script">Edit Script</button>
        <button class="context-item" data-action="version-check">Versions Check</button>
        <button class="context-item" data-action="rebuild-env">Rebuild Environment</button>
        <button class="context-item" data-action="clone" disabled>Clone</button>
        <button class="context-item" data-action="instantiate" disabled>Instantiate</button>
        <button class="context-item" data-action="output_viewer" disabled>Output Viewer</button>
    </div>

    <!-- Split.js library -->
    <script src="https://unpkg.com/split.js/dist/split.min.js"></script>
    <!-- NEW: Xterm.js library and Fit Addon -->
    <script src="https://cdn.jsdelivr.net/npm/xterm@5.3.0/lib/xterm.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xterm-addon-fit@0.8.0/lib/xterm-addon-fit.min.js"></script>
    <!-- Sortable.js for drag-and-drop -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@latest/Sortable.min.js"></script>
    <!-- Our application script -->
    <script src="/static/app.js"></script>

    <!-- Modal for Delete Options -->
    <div id="delete-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2>Delete Instance: <span id="delete-modal-instance-name"></span></h2>
            <p>Choose a deletion method:</p>
            <div class="modal-actions">
                <button id="delete-btn-permanent" class="action-btn danger-btn">Permanent Delete</button>
                <button id="delete-btn-trash" class="action-btn">Move to Trashcan</button>
                <button id="delete-btn-cancel" class="action-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Modal for Overwrite Confirmation -->
    <div id="overwrite-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2>Overwrite Confirmation</h2>
            <p>An instance with the name "<span id="overwrite-modal-instance-name"></span>" already exists in the trashcan.</p>
            <p>Do you want to overwrite it?</p>
            <div class="modal-actions">
                <button id="overwrite-btn-confirm" class="action-btn danger-btn">Overwrite</button>
                <button id="overwrite-btn-cancel" class="action-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Modal for Rebuild Confirmation -->
    <div id="rebuild-modal" class="modal-overlay hidden">
        <div class="modal-content">
            <h2>Rebuild Environment: <span id="rebuild-modal-instance-name"></span></h2>
            <p id="rebuild-modal-message">This will rebuild the environment. Continue?</p>
            <div class="modal-actions">
                <button id="rebuild-btn-confirm" class="action-btn success-btn">Confirm Rebuild</button>
                <button id="rebuild-btn-cancel" class="action-btn danger-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- NEW: Toast Notification Container -->
    <div id="toast-container"></div>
</body>

</html>